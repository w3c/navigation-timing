<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>
      Navigation Timing Level 2
    </title>
    <style>
    #obsolete {
      background-position: right;
      background-repeat: repeat-y;
      background-color: rgba(251, 233, 233, 0.5);
      padding: 0 1em;
      background-image: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' version='1.1' height='300px' width='125px'><text x='0' y='100' fill='red' font-size='15' fill-opacity='0.20'>Obsolete<\/text><\/svg>")
    }
    </style>
    <script src='https://www.w3.org/Tools/respec/respec-w3c' class='remove' defer></script>
    <script class='remove'>
    var respecConfig = {
      shortName: "navigation-timing-2",
      specStatus: "ED",
      editors: [{
        name: "Yoav Weiss",
        url: "https://blog.yoav.ws/",
        mailto: "yoav@yoav.ws",
        company: "Google",
        companyURL: "https://google.com/",
        w3cid: "58673"
      }, {
        name: "Noam Rosenthal",
        mailto: "noam.j.rosenthal@gmail.com",
        company: "Invited Expert",
        w3cid: "121539"
      }],
      formerEditors: [
        {
          name: "Ilya Grigorik",
          url: "https://www.igvita.com/",
          mailto: "igrigorik@gmail.com",
          company: "Google",
          companyURL: "https://www.google.com/",
          w3cid: "56102",
        },
        {
          name: "Tobin Titus",
          mailto: "tobint@microsoft.com",
          retiredDate: "2015-01-01",
          company: "Microsoft Corp.",
          w3cid: "69474",
        },
        {
          name: "Jatinder Mann",
          mailto: "jmann@microsoft.com",
          company: "Microsoft Corp.",
          retiredDate: "2014-02-01",
          w3cid: "44357",
        },
        {
          name: "Arvind Jain",
          mailto: "arvind@google.com",
          company: "Google Inc.",
          retiredDate: "2014-12-01",
          w3cid: "45188",
        },
      ],
      group:"webperf",
      wgPublicList: "public-web-perf",
      subjectPrefix: "[NavigationTiming]",
      github: "https://github.com/w3c/navigation-timing/",
      testSuiteURI: "https://wpt.fyi/navigation-timing/",
      caniuse: "nav-timing",
      mdn: "navigation-timing",
      xref: {
        url: "https://respec.org/xref",
        specs: [ "service-workers", "hr-time-2", "performance-timeline-2", "resource-timing-2", "html", "fetch"],
        profile: "web-platform",
      },
      localBiblio: {
        JSMEASURE: {
          title: "Measuring Client-Perceived Response Times on the WWW",
          href:
            "http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.69.7329&rep=rep1&type=pdf",
          authors: ["Ramakrishnan Rajamony", "Mootaz Elnozahy"],
          status:
            "The Proceedings of the 3rd USENIX Symposium on Internet Technologies and Systems (USITS)",
          date: "March 2001",
        },
      },
      lint: {
        "check-punctuation": true,
      },
      doJsonLd: true,
    };

    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification defines an interface for web applications to access
        the complete timing information for navigation of a document.
      </p>
    </section>
    <section id="sotd">
      <p>
        Navigation Timing 2 replaces the first version of [[NAVIGATION-TIMING]]
        and includes the following changes:
      </p>
      <ul>
        <li>the definition of Performance interface was moved to
        [[PERFORMANCE-TIMELINE-2]];
        </li>
        <li>builds on top of [[RESOURCE-TIMING-2]];
        </li>
        <li>support for [[PERFORMANCE-TIMELINE-2]];
        </li>
        <li>support for [[HR-TIME-2]];
        </li>
        <li>support for <a data-cite="resource-hints#prerender">prerender</a>
        navigations [[RESOURCE-HINTS]];
        </li>
        <li>exposes <a data-lt=
        'PerformanceNavigationTiming.redirectCount'>number of redirects</a>
        since the last non-redirect navigation;
        </li>
        <li>exposes <a data-cite=
        'resource-timing-2#dom-performanceresourcetiming-nexthopprotocol'>next
        hop network protocol</a>;
        </li>
        <li>exposes <a data-cite=
        'resource-timing-2#dom-performanceresourcetiming-transfersize'>transfer</a>,
        <a data-cite=
        'resource-timing-2#dom-performanceresourcetiming-encodedbodysize'>encoded
        body</a> and <a data-cite=
        'resource-timing-2#dom-performanceresourcetiming-decodedbodysize'>decoded
        body</a> size information;
        </li>
        <li>
          <a data-cite=
          'resource-timing-2#dom-performanceresourcetiming-secureconnectionstart'>
          secureConnectionStart</a> attribute is now mandatory.
        </li>
      </ul>
    </section>
    <section id="introduction" class='informative'>
      <h2>
        Introduction
      </h2>
      <p>
        Accurately measuring performance characteristics of web applications is
        an important aspect of making web applications faster. While
        JavaScript-based mechanisms, such as the one described in
        [[JSMEASURE]], can provide comprehensive instrumentation for user
        latency measurements within an application, in many cases, they are
        unable to provide a complete or detailed end-to-end latency picture.
        For example, the following JavaScript shows a naive attempt to measure
        the time it takes to fully load a page:
      </p>
      <pre class='example'>
        &lt;html&gt;
        &lt;head&gt;
        &lt;script type="text/javascript"&gt;
        var start = new Date().getTime();
        function onLoad() {
          var now = new Date().getTime();
          var latency = now - start;
          alert("page loading time: " + latency);
        }
        &lt;/script&gt;
        &lt;/head&gt;
        &lt;body onload="onLoad()"&gt;
        &lt;!- Main page body goes from here. --&gt;
        &lt;/body&gt;
        &lt;/html&gt;
      </pre>
      <p>
        The above script calculates the time it takes to load the page
        <b>after</b> the first bit of JavaScript in the head is executed, but
        it does not give any information about the time it takes to get the
        page from the server, or the initialization lifecycle of the page.
      </p>
      <p>
        This specification defines the {{PerformanceNavigationTiming}}
        interface which participates in the [[PERFORMANCE-TIMELINE-2]] to store
        and retrieve high resolution performance metric data related to the
        navigation of a document. As the {{PerformanceNavigationTiming}}
        interface uses [[HR-TIME-2]], all time values are measured with respect
        to the <a data-cite="HR-TIME-2#dfn-time-origin">time origin</a> of the
        {{Window}} object.
      </p>
      <p>
        For example, if we know that the response end occurs 100ms after the
        start of navigation, the {{PerformanceNavigationTiming}} data could
        look like so:
      </p>
      <pre class="example">
      startTime:           0.000  // start time of the navigation request
      responseEnd:       100.000  // high resolution time of last received byte
      </pre>
      <p>
        The following script shows how a developer can use the
        {{PerformanceNavigationTiming}} interface to obtain accurate timing
        data related to the navigation of the document:
      </p>
      <pre class="example">
        &lt;script&gt;
        function showNavigationDetails() {
          // Get the first entry
          const [entry] = performance.getEntriesByType("navigation");
          // Show it in a nice table in the developer console
          console.table(entry.toJSON());
        }
        &lt;/script&gt;
        &lt;body onload="showNavigationDetails()"&gt;
      </pre>
    </section>
    <section id="terminology">
      <h2>
        Terminology
      </h2>
      <p>
        The construction "a <code>Foo</code> object", where <code>Foo</code> is
        actually an interface, is sometimes used instead of the more accurate
        "an object implementing the interface <code>Foo</code>.
      </p>
      <p>
        The term <dfn>navigation</dfn> refers to the act of <a data-lt=
        "navigate">navigating</a>.
      </p>
      <p>
        The term <dfn>current document</dfn> refers to the document associated
        with the <a data-lt="associated document">Window object's newest
        Document object</a>.
      </p>
      <p>
        The term <dfn>JavaScript</dfn> is used to refer to ECMA262, rather than
        the official term ECMAScript, since the term JavaScript is more widely
        known. [[ECMASCRIPT]]
      </p>
      <p>
        Throughout this work, all time values are measured in milliseconds
        since the start of navigation of the document. For example, the start
        of navigation of the document occurs at time 0. The term <i>current
        time</i> refers to the number of milliseconds since the start of
        navigation of the document until the current moment in time. This
        definition of time is based on [[HR-TIME-2]] specification.
      </p>
    </section>
    <section id="sec-navigation-timing">
      <h2>
        Navigation Timing
      </h2>
      <section id='performanceentry'>
        <h3>
          Relation to the {{PerformanceEntry}} interface
        </h3>
        <p>
          {{PerformanceNavigationTiming}} interface extends the following
          attributes of <code><dfn data-cite=
          "PERFORMANCE-TIMELINE-2#dom-performanceentry">PerformanceEntry</dfn></code>
          interface:
        </p>
        <ul>
          <li>The <dfn id=
          'dom-PerformanceNavigationTiming-name'><code>name</code></dfn>
          attribute MUST return the {{DOMString}} value of the <a data-cite=
          "HTML#the-document's-address">address</a> of the <a>current
          document</a>.
          </li>
          <li>The <dfn id=
          'dom-PerformanceNavigationTiming-entryType'><code>entryType</code></dfn>
          attribute MUST return the {{DOMString}} "<code id=
          "perf-navigation">navigation</code>".
          </li>
          <li>The <dfn id=
          'dom-PerformanceNavigationTiming-startTime'><code>startTime</code></dfn>
          attribute MUST return a <code><dfn data-cite=
          "HR-TIME-2#dom-domhighrestimestamp">DOMHighResTimeStamp</dfn></code>
          with a time value of 0. [[HR-TIME-2]]
          </li>
          <li>The <dfn id=
          'dom-PerformanceNavigationTiming-duration'><code>duration</code></dfn>
          attribute MUST return a {{DOMHighResTimeStamp}} equal to the
          difference between <a data-link-for=
          "PerformanceNavigationTiming">loadEventEnd</a> and {{startTime}},
          respectively.
          </li>
        </ul>
        <p class="note">
          A user agent implementing {{PerformanceNavigationTiming}} would need
          to include <code>"navigation"</code> in <a data-cite=
          "PERFORMANCE-TIMELINE-2#supportedentrytypes-attribute">supportedEntryTypes</a>
          for <a data-cite="HTML/window-object.html#window">Window</a>
          contexts. This allows developers to detect support for Navigation
          Timing.
        </p>
      </section>
      <section id='PerformanceResourceTiming'>
        <h3>
          Relation to the <code>PerformanceResourceTiming</code> interface
        </h3>
        <p>
          {{PerformanceNavigationTiming}} interface extends the following
          attributes of the <code><dfn data-cite=
          "RESOURCE-TIMING-2#dom-performanceresourcetiming">PerformanceResourceTiming</dfn></code>
          interface:
        </p>
        <ul data-dfn-for="PerformanceResourceTiming">
          <li>The <dfn>initiatorType</dfn> attribute MUST return the
          {{DOMString}} "<code>navigation</code>".
          </li>
          <li>The <dfn id='dom-PerformanceNavigationTiming-workerStart'><code>
            workerStart</code></dfn> attribute MUST return the time immediately
            before the user agent <a data-cite=
            "service-workers#run-service-worker">ran the worker</a> (if the
            <a>current document</a> has an <a data-cite=
            "service-workers#dfn-containing-service-worker-registration">active
            service worker registration</a> [[SERVICE-WORKERS]]) required to
            service the request, or if the worker was already available, the
            time immediately before the user agent <a data-cite=
            "service-workers#fetchevent">fired an event named `fetch`</a> at
            the <a data-cite="service-workers#dfn-active-worker">active
            worker</a>. Otherwise, if there is no active worker this attribute
            MUST return zero.
          </li>
        </ul>
        <p class="note">
          Only the <a>current document</a> resource is included in the
          performance timeline; there is only one
          {{PerformanceNavigationTiming}} object in the performance timeline.
        </p>
      </section>
      <section data-dfn-for="PerformanceNavigationTiming" id=
      "sec-PerformanceNavigationTiming">
        <h3>
          The <dfn>PerformanceNavigationTiming</dfn> interface
        </h3><!-- from domainLookupEnd -->
        <div class="note">
          <p>
            Checking and retrieving contents from the <a href=
            "https://tools.ietf.org/html/rfc7234">HTTP cache</a> [[RFC7234]] is
            part of the <a data-cite="FETCH#concept-fetch" title=
            'fetch'>fetching process</a>. It's covered by the <a data-cite=
            "resource-timing-2#dom-performanceresourcetiming-requeststart"><code>
            requestStart</code></a>, <a data-cite=
            "resource-timing-2#dom-performanceresourcetiming-responsestart"><code>
            responseStart</code></a> and <a data-cite=
            "resource-timing-2#dom-performanceresourcetiming-responseend"><code>
            responseEnd</code></a> attributes.
          </p>
        </div>
        <pre class='idl'>
        [Exposed=Window]
        interface PerformanceNavigationTiming : PerformanceResourceTiming {
            readonly        attribute DOMHighResTimeStamp unloadEventStart;
            readonly        attribute DOMHighResTimeStamp unloadEventEnd;
            readonly        attribute DOMHighResTimeStamp domInteractive;
            readonly        attribute DOMHighResTimeStamp domContentLoadedEventStart;
            readonly        attribute DOMHighResTimeStamp domContentLoadedEventEnd;
            readonly        attribute DOMHighResTimeStamp domComplete;
            readonly        attribute DOMHighResTimeStamp loadEventStart;
            readonly        attribute DOMHighResTimeStamp loadEventEnd;
            readonly        attribute NavigationType      type;
            readonly        attribute unsigned short      redirectCount;
            [Default] object toJSON();
        };
        </pre>

        <p>A <a>PerformanceNavigationTiming</a> has an associated
        [=document load timing info=] <a data-dfn-for="PerformanceResourceTiming">
        <dfn>document load timing</dfn></a>.


        <p>A <a>PerformanceNavigationTiming</a> has an associated
        [=document unload timing info=] <a data-dfn-for="PerformanceNavigationTiming">
        <dfn>previous document unload timing</dfn></a>.

        <p>A <a>PerformanceNavigationTiming</a> has an associated
        number <a data-dfn-for="PerformanceNavigationTiming"><dfn>redirect count</dfn></a>.

        <p>A <a>PerformanceNavigationTiming</a> has an associated
        {{NavigationType}} <a data-dfn-for="PerformanceNavigationTiming"><dfn>navigation type</dfn></a>.

        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
          The <dfn>unloadEventStart</dfn> getter steps are to return |this|'s
          [=previous document unload timing=]'s [=document unload timing info/unload event start time=].
          </li>
          <p class="note">See <a data-cite=
          "HTML/browsing-the-web.html#unloading-documents">unload event</a> for more info.</p>
        </ol>
        <p data-dfn-for='PerformanceNavigationTiming'>
          The <dfn>unloadEventEnd</dfn> getter steps are to return |this|'s
          [=previous document unload timing=]'s [=document unload timing info/unload event end time=].</li>
          <p class="note">See <a data-cite=
          "HTML/browsing-the-web.html#unloading-documents">unload event</a> for more info.</p>
        </ol>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>domInteractive</dfn> getter steps are to return
         |this|'s [=document load timing=]'s <a data-cite="HTML#dom-interactive-time">DOM
         interactive time</a>.</p>

        <p class="note">See <a data-cite=
          "HTML/dom.html#current-document-readiness">document readiness</a> for more info.
        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>domContentLoadedEventStart</dfn> getter steps are to return |this|'s
         [=document load timing=]'s <a data-cite="HTML#dom-content-loaded-event-end-time">DOM
         content loaded event start time</a>.</p>
        <p class="note">See <a data-cite=
          "HTML/parsing.html#the-end:event-domcontentloaded">DOMContentLoaded</a> for more info.
        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>domContentLoadedEventEnd</dfn> getter steps are to return
         |this|'s [=document load timing=]'s <a data-cite="HTML#dom-content-loaded-event-end-time">DOM
         content loaded event end time</a>.</p>
          "HTML/parsing.html#the-end:event-domcontentloaded">DOMContentLoaded
          event</a> completes.
        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>domComplete</dfn> getter steps are to return
         |this|'s [=document load timing=]'s <a data-cite="HTML#dom-complete-time">DOM complete
         time</a>.
        <p class="note">See <a data-cite=
          "HTML/dom.html#current-document-readiness">document readiness</a> for more info.
        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>loadEventStart</dfn> getter steps are to return
         |this|'s [=document load timing=]'s [=document load timing info/load event start time=].</p>
        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>loadEventEnd</dfn> getter steps are to return
         |this|'s [=document load timing=]'s [=document load timing info/load event end time=].</p>
        </p>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>type</dfn> getter steps are to run the |this|'s [=navigation type=].
        </p>
        <div class="note">
          <p>
            Client-side redirects, such as those using the <a data-cite=
            "HTML/semantics.html#attr-meta-http-equiv-refresh">Refresh pragma
            directive</a>, are not considered <a data-cite=
            "FETCH#redirect-status">HTTP redirects</a> by this spec. In those
            cases, the <a data-link-for="PerformanceNavigationTiming">type</a>
            attribute SHOULD return appropriate value, such as
            <a data-link-for="NavigationType">reload</a> if reloading the
            current page, or <a data-link-for="NavigationType">navigate</a> if
            navigating to a new URL.
          </p>
        </div>
        <p data-dfn-for='PerformanceNavigationTiming'>
         The <dfn>redirectCount</dfn> getter steps are to return |this|'s
         <span>redirect count</span>.</p>
        </p>
        <p>
          The <dfn>toJSON()</dfn> method runs [WEBIDL]'s <a data-cite=
          "WEBIDL/#default-tojson-operation">default toJSON operation</a>.
        </p>
        <section id="sec-performance-navigation-types">
          <h4>
            <dfn>NavigationType</dfn> enum
          </h4>
          <pre class='idl'>
            enum NavigationType {
                "navigate",
                "reload",
                "back_forward",
                "prerender"
            };
          </pre>
          <p>
            The values are defined as follows:
          </p>
          <dl data-dfn-for='NavigationType'>
            <dt>
              <dfn>navigate</dfn>
            </dt>
            <dd>
              Navigation where the 
              <a data-cite="HTML/browsing-the-web.html#history-handling-behavior">history handling behavior</a>
              is set to
              <a data-cite="HTML/browsing-the-web.html#hh-default">"default"</a>
              or <a data-cite="HTML/browsing-the-web.html#hh-replace">"replace"</a>
              and the navigation was not initiated by a <a data-cite=
              'resource-hints#prerender'>prerender</a> hint [[RESOURCE-HINTS]].
            </dd>
            <dt>
              <dfn>reload</dfn>
            </dt>
            <dd>
              Navigation where the 
              <a data-cite="HTML/browsing-the-web.html#history-handling-behavior">history handling behavior</a>
              is set to
              <a data-cite="HTML/browsing-the-web.html#hh-reload">"reload"</a>.
            </dd>
            <dt>
              <dfn>back_forward</dfn>
            </dt>
            <dd>
              Navigation where the 
              <a data-cite="HTML/browsing-the-web.html#history-handling-behavior">history handling behavior</a>
              is set to
              <a data-cite="HTML/browsing-the-web.html#hh-entry-update">"entry update"</a>.
            </dd>
            <dt>
              <dfn>prerender</dfn>
            </dt>
            <dd>
              Navigation initiated by a <a data-cite=
              'resource-hints#prerender'>prerender</a> hint [[RESOURCE-HINTS]].
            </dd>
          </dl>
          <p class="note">
            The format of the above enumeration value is inconsistent with the
            <a data-cite="WEBIDL/#idl-enums">WebIDL recommendation for
            formatting of enumeration values</a>. Unfortunately, we are unable
            to change it due to backwards compatibility issues with shipped
            implementations.
          </p>
        </section>
      </section>
    </section>
    <section id="process">
      <h2>
        Process
      </h2>
      <section id="processing-model">
        <h3>
          Processing Model
        </h3>
        <figure title='Timing attributes'>
          <figcaption>
            This figure illustrates the timing attributes defined by the
            {{PerformanceNavigationTiming}} interface. Attributes in
            parenthesis indicate that they may not be available for navigations
            involving documents from different <a data-cite=
            "html#concept-origin" title='origin'>origins</a>.
          </figcaption>
          <!-- Source: https://docs.google.com/document/d/1I7XGNJ57Qgjkg9pL11s7MK7zGEcwAgdNj1W5f7NKbW8/ -->
          <img src="timestamp-diagram.svg" alt="Navigation Timing attributes"
          style='width: 100%'>
        </figure>
      </section>
    </section>
    <section id="marking-navigation-timing">
      <h2>Creating a navigation timing entry</h2>
      <p data-dfn-for="Document">Each [=document=] has an associated <dfn>navigation timing entry</dfn>, initially unset.

      <p>To <dfn export="">create the navigation timing entry</dfn> for {{Document}} |document|,
      given a [=fetch timing info=] |fetchTiming|, a number |redirectCount|, and a
      {{NavigationType}} |navigationType|, do the following:
      <ol>
        <li>Let |global| be |document|'s [=relevant global object=].</li>
        <li>Let |navigationTimingEntry| be a new {{PerformanceNavigationTiming}} object in |global|'s
        [=global object/realm=].
        <li><a data-cite="RESOURCE-TIMING-2#dfn-setup-the-resource-timing-entry">Setup the resource
        timing entry=] for |navigationTimingEntry| given "<code>navigation</code>", |document|'s
        <a data-cite="HTML#the-document's-address">address</a>, and |fetchTiming|.
        <li>Set |navigationTimingEntry|'s <a data-for="PerformanceNavigationTiming">document load
        timing</a> to |document|'s [=Document/load timing info=]
        <li>Set |navigationTimingEntry|'s <a data-for="PerformanceNavigationTiming">previous
        document unload timing</a> to |document|'s [=Document/previous document unload timing=].
        <li>Set |navigationTimingEntry|'s <a data-for="PerformanceNavigationTiming">redirect
        count</a> to |redirectCount|.
        <li>Set |navigationTimingEntry|'s <a data-for="PerformanceNavigationTiming">navigation
        type</a> to |navigationType|.
        <li>Set |document|'s <span>navigation timing entry</span> to |navigationTimingEntry|.
        <li>add |navigationTimingEntry| to |global|'s
        <a data-cite='performance-timeline-2#dfn-performance-entry-buffer'>performance entry buffer</a>.
      </ol>

      <p>To <dfn export="">queue the navigation timing entry</dfn> for {{Document}} |document|,
      <a data-cite='performance-timeline-2#dfn-queue-a-performanceentry'>queue</a> |document|'s
      <span>navigation timing entry</span>.
    </secript>

    <section id="privacy" class='informative'>
      <h2>
        Privacy
      </h2>
      <section id="info_disclosure">
        <h3>
          Information disclosure
        </h3>
        <p>
          There is the potential for disclosing an end-user's browsing and
          activity history by using carefully crafted timing attacks. For
          instance, the unloading time reveals how long the previous page takes
          to execute its unload handler, which could be used to infer the
          user's login status. These attacks have been mitigated by enforcing
          the [=same origin=] check algorithm when unloading a document, as detailed in
          <a data-cite="HTML#update-the-session-history-with-the-new-page">the HTML spec</a>.
        </p>
        <p>
          The <a data-cite=
          "HTML/origin.html#relaxing-the-same-origin-restriction">relaxed same
          origin policy</a> doesn't provide sufficient protection against
          unauthorized visits across documents. In shared hosting, an untrusted
          third party is able to host an HTTP server at the same IP address but
          on a different port.
        </p>
      </section>
      <section id="cross-directory">
        <h3>
          Cross-directory access
        </h3>
        <p>
          Different pages sharing one host name, for example contents from
          different authors hosted on sites with user generated content are
          considered from the same origin because there is no feature to
          restrict the access by pathname. Navigating between these pages
          allows a latter page to access timing information of the previous
          one, such as timing regarding redirection and unload event.
        </p>
      </section>
    </section>
    <section id="security" class='informative'>
      <h2>
        Security
      </h2>
      <p>
        The {{PerformanceNavigationTiming}} interface exposes timing
        information about the previous document to the <a>current document</a>.
        To limit the access to {{PerformanceNavigationTiming}} attributes which
        include information on the previous document, the 
        <a data-cite="HTML#update-the-session-history-with-the-new-page">previous document
        unloading</a> algorithm enforces the <a data-cite="html#same-origin">same origin policy</a>
        and attributes related to the previous document are set to zero.
      </p>
      <section id="authentication">
        <h3>
          Detecting proxy servers
        </h3>
        <p>
          In case a proxy is deployed between the user agent and the web
          server, the time interval between the <a data-cite=
          "resource-timing-2#dom-performanceresourcetiming-connectstart"><code>connectStart</code></a>
          and the <a data-cite=
          "resource-timing-2#dom-performanceresourcetiming-connectend"><code>connectEnd</code></a>
          attributes indicates the delay between the user agent and the proxy
          instead of the web server. With that, web server can potentially
          infer the existence of the proxy. For SOCKS proxy, this time interval
          includes the proxy authentication time and time the proxy takes to
          connect to the web server, which obfuscate the proxy detection. In
          case of an HTTP proxy, the user agent might not have any knowledge
          about the proxy server at all so it's not always feasible to mitigate
          this attack.
        </p>
      </section>
    </section>
    <section id='obsolete'>
      <h2>
        Obsolete
      </h2>
      <p>
        This section defines attributes and interfaces previously introduced in
        [[NAVIGATION-TIMING]] Level 1 and are kept here for backwards
        compatibility. Authors should not use the following interfaces and are
        <strong>strongly advised</strong> to use the new
        {{PerformanceNavigationTiming}} interface—see <a href="#sotd">summary
        of changes and improvements</a>.
      </p>
      <section data-dfn-for="PerformanceTiming">
        <h3>
          The <dfn>PerformanceTiming</dfn> interface
        </h3>
        <pre class="idl">
[Exposed=Window]
interface PerformanceTiming {
  readonly attribute unsigned long long navigationStart;
  readonly attribute unsigned long long unloadEventStart;
  readonly attribute unsigned long long unloadEventEnd;
  readonly attribute unsigned long long redirectStart;
  readonly attribute unsigned long long redirectEnd;
  readonly attribute unsigned long long fetchStart;
  readonly attribute unsigned long long domainLookupStart;
  readonly attribute unsigned long long domainLookupEnd;
  readonly attribute unsigned long long connectStart;
  readonly attribute unsigned long long connectEnd;
  readonly attribute unsigned long long secureConnectionStart;
  readonly attribute unsigned long long requestStart;
  readonly attribute unsigned long long responseStart;
  readonly attribute unsigned long long responseEnd;
  readonly attribute unsigned long long domLoading;
  readonly attribute unsigned long long domInteractive;
  readonly attribute unsigned long long domContentLoadedEventStart;
  readonly attribute unsigned long long domContentLoadedEventEnd;
  readonly attribute unsigned long long domComplete;
  readonly attribute unsigned long long loadEventStart;
  readonly attribute unsigned long long loadEventEnd;
  [Default] object toJSON();
};
</pre>
        <p class="note">
          All time values defined in this section are measured in milliseconds
          since midnight of <time datetime="1970-01-01T00:00Z">January 1, 1970
          (UTC)</time>.
        </p>
        <dl>
          <dt>
            <dfn>navigationStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately after the user
              agent finishes <a data-cite=
              "HTML/browsing-the-web.html#prompt-to-unload-a-document">prompting
              to unload</a> the previous document. If there is no previous
              document, this attribute must return the time the current
              document is created.
            </p>
            <p class="note">
              This attribute is not defined for
              {{PerformanceNavigationTiming}}. Instead, authors can use
              <a data-cite=
              "HR-TIME-2#dom-performance-timeorigin">timeOrigin</a> to obtain
              an equivalent timestamp.
            </p>
          </dd>
          <dt>
            <dfn>unloadEventStart</dfn>
          </dt>
          <dd>
            <p>
              If the previous document and the current document have the same
              <a data-cite="html#concept-origin">origin</a>, this attribute
              must return the time immediately before the user agent starts the
              <a data-cite=
              "HTML/browsing-the-web.html#unloading-documents">unload</a> event
              of the previous document. If there is no previous document or the
              previous document has a different <a data-cite=
              "html#concept-origin">origin</a> than the current document, this
              attribute must return zero.
            </p>
          </dd>
          <dt>
            <dfn>unloadEventEnd</dfn>
          </dt>
          <dd>
            <p>
              If the previous document and the current document have the same
              <a data-cite="html#same-origin">same origin</a>, this attribute
              must return the time immediately after the user agent finishes
              the <a data-cite=
              "HTML/browsing-the-web.html#unload-a-document">unload</a> event
              of the previous document. If there is no previous document or the
              previous document has a different <a data-cite=
              "html#concept-origin">origin</a> than the current document or the
              unload is not yet completed, this attribute must return zero.
            </p>
            <p>
              If there are <a data-cite="FETCH#redirect-status">HTTP
              redirects</a> when navigating and not all the redirects are from
              the same <a data-cite="html#concept-origin">origin</a>, both
              {{PerformanceTiming.unloadEventStart}} and
              {{PerformanceTiming.unloadEventEnd}} must return zero.
            </p>
          </dd>
          <dt>
            <dfn>redirectStart</dfn>
          </dt>
          <dd>
            <p>
              If there are <a data-cite="FETCH#redirect-status">HTTP
              redirects</a> when navigating and if all the redirects are from
              the same <a data-cite="html#concept-origin">origin</a>, this
              attribute must return the <a data-lt=
              'PerformanceTiming.fetchStart'>starting time of the fetch</a>
              that initiates the redirect. Otherwise, this attribute must
              return zero.
            </p>
          </dd>
          <dt>
            <dfn>redirectEnd</dfn>
          </dt>
          <dd>
            <p>
              If there are <a data-cite="FETCH#redirect-status">HTTP
              redirects</a> when navigating and all redirects are from the same
              <a data-cite="html#concept-origin">origin</a>, this attribute
              must return the time immediately after receiving the last byte of
              the response of the last redirect. Otherwise, this attribute must
              return zero.
            </p>
          </dd>
          <dt>
            <dfn>fetchStart</dfn>
          </dt>
          <dd>
            <p>
              If the new resource is to be <a data-cite=
              "HTML/urls-and-fetching.html#fetching-resources">fetched</a>
              using a "GET" <a data-cite="FETCH#concept-request-method">request
              method</a>, fetchStart must return the time immediately before
              the user agent starts checking <a data-cite=
              "HTML/offline.html#relevant-application-cache">any relevant
              application caches</a>. Otherwise, it must return the time when
              the user agent starts <a data-cite=
              "HTML/urls-and-fetching.html#fetching-resources">fetching</a> the
              resource.
            </p>
          </dd>
          <dt>
            <dfn>domainLookupStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent starts the domain name lookup for the current document. If
              a <a href=
              "https://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
              connection</a> [[RFC2616]] is used or the current document is
              retrieved from <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or local resources, this attribute must
              return the same value as {{PerformanceTiming.fetchStart}}.
            </p>
          </dd>
          <dt>
            <dfn>domainLookupEnd</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately after the user
              agent finishes the domain name lookup for the current document.
              If a <a href=
              "https://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
              connection</a> [[RFC2616]] is used or the current document is
              retrieved from <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or local resources, this attribute must
              return the same value as {{PerformanceTiming.fetchStart}}.
            </p>
            <div class="note">
              <p>
                Checking and retrieving contents from the <a href=
                "https://www.w3.org/Protocols/rfc2616/rfc2616-sec13.html#sec13">
                HTTP cache</a> [[RFC2616]] is part of the <a data-cite=
                "HTML/urls-and-fetching.html#fetching-resources">fetching
                process</a>. It's covered by the
                {{PerformanceTiming.requestStart}},
                {{PerformanceTiming.responseStart}} and
                {{PerformanceTiming.responseEnd}} attributes.
              </p>
            </div>
            <p class="note">
              In case where the user agent already has the domain information
              in cache, domainLookupStart and domainLookupEnd represent the
              times when the user agent starts and ends the domain data
              retrieval from the cache.
            </p>
          </dd>
          <dt>
            <dfn>connectStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent start establishing the connection to the server to retrieve
              the document. If a <a href=
              "https://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
              connection</a> [[RFC2616]] is used or the current document is
              retrieved from <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or local resources, this attribute must
              return value of {{PerformanceTiming.domainLookupEnd}}.
            </p>
          </dd>
          <dt>
            <dfn>connectEnd</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately after the user
              agent finishes establishing the connection to the server to
              retrieve the current document. If a <a href=
              "https://www.w3.org/Protocols/rfc2616/rfc2616-sec8.html#sec8.1">persistent
              connection</a> [[RFC2616]] is used or the current document is
              retrieved from <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or local resources, this attribute must
              return the value of {{PerformanceTiming.domainLookupEnd}}.
            </p>
            <p>
              If the transport connection fails and the user agent reopens a
              connection, {{PerformanceTiming.connectStart}} and
              {{PerformanceTiming.connectEnd}} should return the corresponding
              values of the new connection.
            </p>
            <p>
              {{PerformanceTiming.connectEnd}} must include the time interval
              to establish the transport connection as well as other time
              interval such as SSL handshake and SOCKS authentication.
            </p>
          </dd>
          <dt>
            <dfn>secureConnectionStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute is optional. User agents that don't have this
              attribute available must set it as undefined. When this attribute
              is available, if the <a data-cite=
              "url#concept-url-scheme">scheme</a> [[URL]] of the current page
              is "https", this attribute must return the time immediately
              before the user agent starts the handshake process to secure the
              current connection. If this attribute is available but HTTPS is
              not used, this attribute must return zero.
            </p>
          </dd>
          <dt>
            <dfn>requestStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent starts requesting the current document from the server, or
              from <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or from local resources.
            </p>
            <p>
              If the transport connection fails after a request is sent and the
              user agent reopens a connection and resend the request,
              {{PerformanceTiming.requestStart}} should return the
              corresponding values of the new request.
            </p>
            <div class="note">
              <p>
                This interface does not include an attribute to represent the
                completion of sending the request, e.g., requestEnd.
              </p>
              <ul>
                <li>Completion of sending the request from the user agent does
                not always indicate the corresponding completion time in the
                network transport, which brings most of the benefit of having
                such an attribute.
                </li>
                <li>Some user agents have high cost to determine the actual
                completion time of sending the request due to the HTTP layer
                encapsulation.
                </li>
              </ul>
            </div>
          </dd>
          <dt>
            <dfn>responseStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately after the user
              agent receives the first byte of the response from the server, or
              from <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or from local resources.
            </p>
          </dd>
          <dt>
            <dfn>responseEnd</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately after the user
              agent receives the last byte of the current document or
              immediately before the transport connection is closed, whichever
              comes first. The document here can be received either from the
              server, <a data-cite=
              "HTML/offline.html#relevant-application-cache">relevant
              application caches</a> or from local resources.
            </p>
          </dd>
          <dt>
            <dfn>domLoading</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent sets the <a data-cite=
              "HTML/dom.html#current-document-readiness">current document
              readiness</a> to <a data-cite=
              "HTML/dom.html#current-document-readiness">"loading"</a>.
            </p>
            <p class="warning">
              Due to differences in when a Document object is created in
              existing user agents, the value returned by the
              <code>domLoading</code> is implementation specific and should not
              be used in meaningful metrics.
            </p>
          </dd>
          <dt>
            <dfn>domInteractive</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent sets the <a data-cite=
              "HTML/dom.html#current-document-readiness">current document
              readiness</a> to <a data-cite=
              "HTML/parsing.html#the-end">"interactive"</a>.
            </p>
          </dd>
          <dt>
            <dfn>domContentLoadedEventStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent fires <a data-cite="HTML/parsing.html#the-end">the
              DOMContentLoaded event</a> at the <a data-cite=
              "HTML/dom.html#document"><code>Document</code></a>.
            </p>
          </dd>
          <dt>
            <dfn>domContentLoadedEventEnd</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately after the
              document's <a data-cite=
              "HTML/parsing.html#the-end">DOMContentLoaded event</a> completes.
            </p>
          </dd>
          <dt>
            <dfn>domComplete</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the user
              agent sets the <a data-cite=
              "HTML/dom.html#current-document-readiness">current document
              readiness</a> to <a data-cite=
              "HTML/parsing.html#the-end">"complete"</a>.
            </p>
            <p>
              If the <a data-cite=
              "HTML/dom.html#current-document-readiness">current document
              readiness</a> changes to the same state multiple times,
              {{PerformanceTiming.domLoading}},
              {{PerformanceTiming.domInteractive}},
              {{PerformanceTiming.domContentLoadedEventStart}},
              {{PerformanceTiming.domContentLoadedEventEnd}} and
              {{PerformanceTiming.domComplete}} must return the time of the
              first occurrence of the corresponding <a data-cite=
              "HTML/dom.html#current-document-readiness">document readiness</a>
              change.
            </p>
          </dd>
          <dt>
            <dfn>loadEventStart</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time immediately before the load
              event of the current document is fired. It must return zero when
              the load event is not fired yet.
            </p>
          </dd>
          <dt>
            <dfn>loadEventEnd</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the time when the load event of the
              current document is completed. It must return zero when the load
              event is not fired or is not completed.
            </p>
          </dd>
          <dt>
            <dfn>toJSON()</dfn>
          </dt>
          <dd>
            Runs [WEBIDL]'s <a data-cite=
            "WEBIDL/#default-tojson-operation">default toJSON operation</a>.
          </dd>
        </dl>
      </section>
      <section data-dfn-for="PerformanceNavigation">
        <h3>
          The <dfn>PerformanceNavigation</dfn> interface
        </h3>
        <pre class="idl">
[Exposed=Window]
interface PerformanceNavigation {
  const unsigned short TYPE_NAVIGATE = 0;
  const unsigned short TYPE_RELOAD = 1;
  const unsigned short TYPE_BACK_FORWARD = 2;
  const unsigned short TYPE_RESERVED = 255;
  readonly attribute unsigned short type;
  readonly attribute unsigned short redirectCount;
  [Default] object toJSON();
};
</pre>
        <dl>
          <dt>
            <dfn>TYPE_NAVIGATE</dfn>
          </dt>
          <dd>
            <p>
              Navigation where the 
              <a data-cite="HTML/browsing-the-web.html#history-handling-behavior">history handling behavior</a>
              is set to
              <a data-cite="HTML/browsing-the-web.html#hh-default">"default"</a> or
              <a data-cite="HTML/browsing-the-web.html#hh-replace">"replace"</a>.
            </p>
          </dd>
          <dt>
            <dfn>TYPE_RELOAD</dfn>
          </dt>
          <dd>
            <p>
              Navigation where the 
              <a data-cite="HTML/browsing-the-web.html#history-handling-behavior">history handling behavior</a>
              is set to
              <a data-cite="HTML/browsing-the-web.html#hh-reload">"reload"</a>.
            </p>
          </dd>
          <dt>
            <dfn>TYPE_BACK_FORWARD</dfn>
          </dt>
          <dd>
            <p>
              Navigation where the 
              <a data-cite="HTML/browsing-the-web.html#history-handling-behavior">history handling behavior</a>
              is set to
              <a data-cite="HTML/browsing-the-web.html#hh-entry-update">"entry update"</a>.
            </p>
          </dd>
          <dt>
            <dfn>TYPE_RESERVED</dfn>
          </dt>
          <dd>
            <p>
              Any navigation types not defined by values above.
            </p>
          </dd>
          <dt>
            <dfn>type</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the type of the last non-redirect
              <a data-cite="HTML/browsing-the-web.html#navigate">navigation</a>
              in the current browsing context. It must have one of the
              following <a data-lt=
              "PerformanceNavigationTiming.type">navigation type</a> values.
            </p>
            <p class="note">
              Client-side redirects, such as those using <a data-cite=
              "HTML/semantics.html#attr-meta-http-equiv-refresh">the Refresh
              pragma directive</a>, are not considered <a data-cite=
              "FETCH#redirect-status">HTTP redirects</a> by this spec. In those
              cases, the <a data-lt="PerformanceNavigationTiming.type">type</a>
              attribute should return appropriate value, such as
              <code>TYPE_RELOAD</code> if reloading the current page, or
              <code>TYPE_NAVIGATE</code> if navigating to a new URL.
            </p>
          </dd>
          <dt>
            <dfn>redirectCount</dfn>
          </dt>
          <dd>
            <p>
              This attribute must return the number of redirects since the last
              non-redirect navigation under the current browsing context. If
              there is no redirect or there is any redirect that is not from
              the <a data-cite="html#same-origin">same origin</a> as the
              destination document, this attribute must return zero.
            </p>
          </dd>
          <dt>
            <dfn>toJSON()</dfn>
          </dt>
          <dd>
            Runs [WEBIDL]'s <a data-cite=
            "WEBIDL/#default-tojson-operation">default toJSON operation</a>.
          </dd>
        </dl>
      </section>
      <section data-dfn-for="Performance">
        <h3>
          Extensions to the <code>Performance</code> interface
        </h3>
        <pre class="idl">
        [Exposed=Window]
        partial interface Performance {
          [SameObject]
          readonly attribute PerformanceTiming timing;
          [SameObject]
          readonly attribute PerformanceNavigation navigation;
        };
        </pre>
        <p>
          The <dfn>Performance</dfn> interface is defined in
          [[PERFORMANCE-TIMELINE-2]].
        </p>
        <dl>
          <dt>
            <dfn>timing</dfn>
          </dt>
          <dd>
            <p>
              The <code>timing</code> attribute represents the timing
              information related to the browsing contexts since the last
              non-redirect navigation. This attribute is defined by the
              <code>PerformanceTiming</code> interface.
            </p>
          </dd>
          <dt>
            <dfn>navigation</dfn>
          </dt>
          <dd>
            <p>
              The <code>navigation</code> attribute is defined by the
              <code>PerformanceNavigation</code> interface.
            </p>
          </dd>
        </dl>
      </section>
    </section>
    <section id="conformance"></section>
    <section id="acknowledgements" class="appendix">
      <h2>
        Acknowledgments
      </h2>
      <p>
        Thanks to Anne Van Kesteren, Arvind Jain, Boris Zbarsky, Jason Weber,
        Jonas Sicking, James Simonsen, Karen Anderson, Nic Jansma, Philippe Le
        Hegaret, Steve Souders, Todd Reifsteck, Tony Gentilcore, William Chan
        and Zhiheng Wang for their contributions to this work.
      </p>
    </section>
  </body>
</html>
